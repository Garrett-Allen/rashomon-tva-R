---
title: "rashomon_package"
author: "garrett-allen"
format: html
editor: visual
---

```{r}
library(rashomontva)
library(tidyverse)
library(collections)
library(data.table)
```

#todo add examples

```{r}

data <- assign_policy_label(data,arm1,arm2)
policy_list <- rashomontva::create_policies_from_data(data, arm1, arm2)
sigma <- matrix(c(1,1,1,1), ncol = 2, nrow = 2)

edge_list <- lattice_edges(sigma, policy_list)

new_sigma <- matrix(c(0,1,1,1), ncol = 2, nrow = 2)
pruned_edge_list <- prune_edges(new_sigma,edge_list,policy_list)

cc <- connected_components(length(pruned_edge_list),pruned_edge_list,policy_list)

cc$as_list()
str(cc$keys()[[1]])
str(1)
data %>% 
  rowwise() %>% 
  mutate(pool = cc$get(policy_label))

str(data$policy_label[1])
```

```{r}
data <- data.frame(arm1 = c(1,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,2,2,3,3,3,3,3,3,3,3,3),
                   arm2 = c(1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3,1,2,3),
                   value = runif(27))
#searching rashomon set


policy_means <- function(data, value, ...){
  
  #convert to data.table
  data %>% 
    group_by(...) %>% 
    summarize(mean = mean({{value}}),
              .groups = "drop", 
              policy_label = policy_label[1])
}
#note: data argument here must be output from policy_means
pool_means <- function(data, value, pool){
  
  data %>% 
    group_by({{pool}}) %>% 
    summarize(mean_pool = mean({{value}}))
}

pools_to_data <- function(data,policy_list, pools_dict, value){
  
  data %>% 
    rowwise() %>% 
    mutate(pool = cc$get(policy_label))
    
}


partition_sigma <- function(i, j, sigma) {
  
  new_sigma = sigma
  new_sigma[i, j:ncol(new_sigma)] = 0
  new_sigma[is.na(sigma)] = NA
  
  new_sigma
}

M <- policy_means(data, value, arm1, arm2)

M <- pools_to_data(M, policy_list, cc, value)

M <- pool_means(M, mean, pool)

compute_B(data, value, sigma, i, j, policy_list, )
```
